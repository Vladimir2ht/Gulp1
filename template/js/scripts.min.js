const body=document.querySelector("body"),header=body.querySelector("header"),big_popups=header.querySelectorAll(".big_popup");let cities=[],select;function Open_select(e,t){big_popups.forEach(e=>e.classList.add("hidden")),(select=header.querySelector(""+t)).classList.remove("hidden"),".sity_drop_window"===t&&"string"!=typeof cities[0]&&fetch("db/cities.json").then(e=>e.json()).then(e=>cities=e).then(e=>{Show_cities(e),select.querySelector(".ripple").classList.add("hidden")}).catch(e=>console.error(e)),e&&e.stopPropagation()}function Show_departments(e){e.map(e=>{(li=document.createElement("li")).innerHTML=`<div>${e[0]}</div><div class="type">${e[1]}</div>`,header.querySelector(".serch_drop_window ul").appendChild(li)})}function Show_cities(e){e.map(e=>{(li=document.createElement("li")).innerHTML=e,header.querySelector(".sity_drop_window ul").appendChild(li)})}const inputs=header.querySelectorAll("input"),close_inputs_el=header.querySelectorAll("[src*=close]");function Ready_reset(e){""===inputs[e].value?close_inputs_el[e].classList.add("hidden"):close_inputs_el[e].classList.remove("hidden")}function Reset(e){inputs[e].value="",close_inputs_el[e].classList.add("hidden"),0===e&&Select_City(null)}const cities_list=big_popups[0].querySelector("ul");function Select_City(e){Ready_reset(0),cities_list.innerHTML="";let i=cities;if(e){let t=new RegExp(""+e.target.value);e.target.value&&(i=cities.filter(e=>t.test(e)))}Show_cities(i)}const big_nav_ul=header.querySelector(".big_nav > ul");let last_li=big_nav_ul.querySelectorAll("li");last_li=last_li[last_li.length-1];const arrows_conteiners=header.querySelectorAll(".big_nav > div");function Stop_scroll(){clearInterval(timer_id),0<+big_nav_ul.style.right.substring(0,big_nav_ul.style.right.length-2)?arrows_conteiners[0].classList.add("active"):arrows_conteiners[0].classList.remove("active"),last_li.getBoundingClientRect().right<=arrows_conteiners[1].getBoundingClientRect().left?arrows_conteiners[1].classList.remove("active"):arrows_conteiners[1].classList.add("active")}header.querySelector("[src*=ArrowR]").classList.remove("hidden");let selected_cities={};function Unselect_city(){}close_inputs_el.forEach((e,t)=>{e.addEventListener("click",()=>Reset(t))});const serch_variants=header.querySelector(".serch_drop_window ul"),arrows=(inputs[0].addEventListener("input",e=>Select_City(e)),inputs[1].addEventListener("input",()=>{serch_variants.innerHTML="",Ready_reset(1),Open_select("",".serch_drop_window"),fetch("db/departments.json").then(e=>e.json()).then(e=>Show_departments(e)).catch(e=>console.error(e))}),body.addEventListener("click",e=>select&&!e.target.closest(".big_popup")?select.classList.add("hidden"):null),header.querySelector(".city_block").addEventListener("click",e=>Open_select(e,".sity_drop_window")),header.querySelectorAll("[src*=Arrow]"));let timer_id,x=0;arrows.forEach((e,t)=>{e.addEventListener("mouseup",()=>Stop_scroll());let i=Boolean(t);e.addEventListener("click",()=>{i?0<last_li.getBoundingClientRect().right-arrows_conteiners[1].getBoundingClientRect().left-200?x+=200:x+=last_li.getBoundingClientRect().right-arrows_conteiners[1].getBoundingClientRect().left:0<x-200?x-=200:x=0,big_nav_ul.style.right=x+"px"}),e.addEventListener("mousedown",()=>{timer_id=setInterval(()=>{last_li.getBoundingClientRect().right<=arrows_conteiners[1].getBoundingClientRect().left&&i||x<0&&!i?Stop_scroll():big_nav_ul.style.right=i?++x+"px":--x+"px"},8)})});const cities_tablo=big_popups[0].querySelector(".cities_tablo"),save_city_b=big_popups[0].querySelector("a"),result_sity=(cities_list.addEventListener("click",t=>{t=t.target.innerText;if(!selected_cities[t]){selected_cities[t]=!0;let e=document.createElement("div");e.innerHTML=t+'<img src="images/white_close.png" width="14px">',cities_tablo.append(e)}cities_tablo.classList.remove("hidden"),save_city_b.classList.add("active")}),cities_tablo.addEventListener("click",t=>{if(t.target.src){let e=t.target.closest("div");delete selected_cities[e.innerText],setTimeout(()=>e.remove(),10),0===Object.keys(selected_cities).length&&(cities_tablo.classList.add("hidden"),save_city_b.classList.remove("active"))}}),header.querySelector(".city_block span"));save_city_b.addEventListener("click",()=>{save_city_b.classList.contains("active")&&(result_sity.innerText=Object.keys(selected_cities).join(", "),selected_cities={},cities_tablo.classList.add("hidden"),cities_tablo.innerHTML="",select.classList.add("hidden"))});